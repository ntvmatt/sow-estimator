<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Native Digital - SOW Cost Estimator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #0a0a0a; color: #fff; }

    .app-container { max-width: 1400px; margin: 0 auto; padding: 20px; }

    .header { background: #0a0a0a; padding: 25px 30px; border-bottom: 1px solid #222; margin-bottom: 30px; display: flex; align-items: center; justify-content: space-between; }
    .header-left { display: flex; align-items: center; gap: 20px; }
    .header-logo {
      font-size: 20px; font-weight: 800; letter-spacing: -0.5px;
      text-transform: uppercase; color: #fff;
    }
    .header-logo span { color: #fff; opacity: 0.5; font-weight: 400; margin-left: 8px; font-size: 14px; text-transform: none; }
    .header h1 { font-size: 14px; font-weight: 500; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    .header p { color: #666; margin-top: 5px; display: none; }

    .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }

    .panel { background: #111; border-radius: 12px; border: 1px solid #222; }
    .panel-header { padding: 20px 25px; border-bottom: 1px solid #222; }
    .panel-header h2 { font-size: 16px; font-weight: 600; color: #fff; }
    .panel-body { padding: 25px; }

    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-weight: 500; margin-bottom: 8px; font-size: 13px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 14px 16px; border: 1px solid #333; border-radius: 8px;
      font-size: 14px; transition: all 0.2s; background: #0a0a0a; color: #fff;
      font-family: 'Inter', sans-serif;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none; border-color: #fff; background: #111;
    }
    .form-group input::placeholder { color: #555; }
    .form-group textarea { min-height: 80px; resize: vertical; }
    .form-group select { cursor: pointer; }
    .form-group select option { background: #111; color: #fff; }

    .kit-selector { display: grid; gap: 10px; }
    .kit-option {
      padding: 18px; border: 1px solid #333; border-radius: 10px; cursor: pointer;
      transition: all 0.2s; background: #0a0a0a;
    }
    .kit-option:hover { border-color: #555; background: #151515; }
    .kit-option.selected { border-color: #fff; background: #1a1a1a; }
    .kit-option.recommended { border-color: #22c55e; background: rgba(34, 197, 94, 0.1); }
    .kit-option.recommended.selected { border-color: #fff; background: #1a1a1a; }
    .kit-option h3 { font-size: 14px; font-weight: 600; margin-bottom: 4px; color: #fff; }
    .kit-option p { font-size: 12px; color: #888; }
    .kit-option .price { font-size: 18px; font-weight: 700; color: #fff; margin-top: 10px; }
    .kit-option .recommended-badge {
      display: inline-block; background: #22c55e; color: #000; font-size: 10px;
      padding: 4px 10px; border-radius: 20px; margin-left: 8px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;
    }

    .brick-list { margin-top: 20px; }
    .brick-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 18px; border: 1px solid #333; border-radius: 8px; margin-bottom: 8px;
      background: #0a0a0a; transition: all 0.2s;
    }
    .brick-item:hover { border-color: #444; }
    .brick-item.included { background: rgba(34, 197, 94, 0.1); border-color: #22c55e; }
    .brick-item.excluded { background: rgba(239, 68, 68, 0.1); border-color: #ef4444; opacity: 0.5; }
    .brick-info { flex: 1; }
    .brick-name { font-weight: 600; font-size: 14px; color: #fff; }
    .brick-desc { font-size: 11px; color: #666; margin-top: 3px; }
    .brick-hours { display: flex; align-items: center; gap: 10px; }
    .brick-hours input { width: 70px; text-align: center; padding: 10px; background: #111; border-color: #333; color: #fff; }
    .brick-hours span { font-size: 12px; color: #666; }
    .brick-toggle { margin-left: 10px; }

    .summary-section { position: sticky; top: 20px; }

    .collapsible-header {
      display: flex; align-items: center; justify-content: space-between;
      cursor: pointer; padding: 14px 0; border-bottom: 1px solid #333; margin-bottom: 15px;
    }
    .collapsible-header:hover { color: #fff; }
    .collapsible-header:hover h3 { color: #fff; }
    .collapsible-header h3 { margin: 0; font-size: 13px; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: 0.5px; transition: color 0.2s; }
    .collapsible-header .toggle-icon { font-size: 12px; color: #666; transition: transform 0.2s; }
    .collapsible-header.open .toggle-icon { transform: rotate(180deg); }
    .collapsible-content { display: none; }
    .collapsible-content.open { display: block; }

    .rich-editor-toolbar {
      display: flex; gap: 5px; padding: 10px; background: #1a1a1a; border: 1px solid #333;
      border-bottom: none; border-radius: 8px 8px 0 0; flex-wrap: wrap;
    }
    .rich-editor-toolbar button {
      padding: 8px 12px; border: 1px solid #333; background: #111; border-radius: 6px;
      cursor: pointer; font-size: 12px; transition: all 0.2s; color: #fff;
    }
    .rich-editor-toolbar button:hover { background: #333; border-color: #444; }
    .rich-editor-toolbar button.active { background: #fff; border-color: #fff; color: #000; }
    .rich-editor-toolbar select {
      padding: 8px 10px; border: 1px solid #333; border-radius: 6px; font-size: 12px;
      background: #111; color: #fff;
    }
    .rich-editor-content {
      min-height: 150px; padding: 15px; border: 1px solid #333; border-radius: 0 0 8px 8px;
      background: #0a0a0a; outline: none; font-size: 14px; line-height: 1.6; color: #fff;
    }
    .rich-editor-content:focus { border-color: #555; }
    .summary-row { display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid #222; }
    .summary-row:last-child { border-bottom: none; }
    .summary-row.total { font-weight: 700; font-size: 20px; border-top: 1px solid #333; margin-top: 10px; padding-top: 18px; }
    .summary-row .label { color: #888; }
    .summary-row.total .label { color: #fff; }

    .btn {
      padding: 14px 28px; border: none; border-radius: 8px; font-size: 14px;
      font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: 'Inter', sans-serif;
    }
    .btn-primary { background: #fff; color: #000; }
    .btn-primary:hover { background: #e5e5e5; transform: translateY(-1px); }
    .btn-secondary { background: #333; color: #fff; }
    .btn-secondary:hover { background: #444; }
    .btn-outline { background: transparent; border: 1px solid #444; color: #fff; }
    .btn-outline:hover { background: #222; border-color: #666; }
    .btn-success { background: #22c55e; color: #000; font-weight: 700; }
    .btn-success:hover { background: #16a34a; }

    .btn-group { display: flex; gap: 12px; margin-top: 20px; }

    .tabs { display: flex; border-bottom: 1px solid #333; margin-bottom: 25px; gap: 5px; }
    .tab { padding: 14px 24px; cursor: pointer; font-weight: 500; border-bottom: 2px solid transparent; margin-bottom: -1px; color: #666; transition: all 0.2s; font-size: 14px; }
    .tab:hover { color: #fff; }
    .tab.active { border-bottom-color: #fff; color: #fff; }
    .tab.disabled { color: #444; cursor: not-allowed; }

    /* Service Toggle Buttons */
    .service-toggles { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .service-toggle {
      padding: 14px 22px; border: 1px solid #333; border-radius: 8px;
      background: #0a0a0a; cursor: pointer; transition: all 0.2s;
      font-weight: 500; font-size: 14px; color: #888;
    }
    .service-toggle:hover { border-color: #555; color: #fff; background: #151515; }
    .service-toggle.active { border-color: #fff; background: #fff; color: #000; font-weight: 600; }

    /* Recommendation Card */
    .recommendation-card {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.05) 100%);
      border: 1px solid #22c55e; border-radius: 12px; padding: 28px; margin-top: 30px;
    }
    .recommendation-card h3 { font-size: 12px; margin-bottom: 12px; color: #22c55e; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
    .recommendation-card .kit-name { font-size: 24px; font-weight: 700; margin-bottom: 8px; color: #fff; }
    .recommendation-card .kit-desc { font-size: 14px; color: #888; margin-bottom: 15px; line-height: 1.5; }
    .recommendation-card .included-services { margin-top: 18px; }
    .recommendation-card .included-services h4 { font-size: 11px; text-transform: uppercase; color: #666; margin-bottom: 12px; letter-spacing: 0.5px; }
    .recommendation-card .service-tag {
      display: inline-block; background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e;
      padding: 6px 12px; border-radius: 20px; font-size: 12px; margin-right: 6px; margin-bottom: 8px; color: #22c55e; font-weight: 500;
    }

    /* Custom Build Card */
    .custom-build-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.02) 100%);
      border: 1px solid #444; border-radius: 12px; padding: 28px; margin-top: 30px;
    }
    .custom-build-card h3 { font-size: 12px; margin-bottom: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
    .custom-build-card .kit-name { font-size: 24px; font-weight: 700; margin-bottom: 8px; color: #fff; }
    .custom-build-card .kit-desc { font-size: 14px; color: #888; margin-bottom: 15px; line-height: 1.5; }

    /* Add-ons Section */
    .addons-section { margin-top: 30px; padding-top: 25px; border-top: 1px solid #333; }
    .addons-section h3 { font-size: 13px; margin-bottom: 18px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
    .addon-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 18px; border: 1px solid #333; border-radius: 8px; margin-bottom: 8px;
      background: #0a0a0a; transition: all 0.2s;
    }
    .addon-item:hover { border-color: #444; }
    .addon-item.selected { background: rgba(255, 255, 255, 0.05); border-color: #fff; }
    .addon-info { flex: 1; }
    .addon-name { font-weight: 600; font-size: 14px; color: #fff; }
    .addon-desc { font-size: 11px; color: #666; margin-top: 3px; }

    /* Scrollbar Styling */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #444; }

    /* Checkbox styling */
    input[type="checkbox"] {
      width: 18px; height: 18px; accent-color: #22c55e; cursor: pointer;
    }

    /* PDF Preview Styles */
    .pdf-preview { display: none; }
    .pdf-preview.visible { display: block; }

    #pdf-content {
      background: #fff; padding: 40px; max-width: 800px; margin: 0 auto;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      color: #000;
    }

    .pdf-header { border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px; }
    .pdf-logo { font-size: 18px; font-weight: 600; margin-bottom: 20px; color: #000; }
    .pdf-title { font-size: 32px; font-weight: 700; margin-bottom: 5px; color: #000; }
    .pdf-client { font-size: 28px; color: #F5CB5C; font-weight: 600; }
    .pdf-date { font-size: 14px; color: #666; margin-top: 5px; }

    .pdf-mission {
      font-size: 24px; font-weight: 600; line-height: 1.4; margin: 30px 0;
      padding: 20px 0;
    }
    .pdf-mission span { background: #F5CB5C; color: #000; padding: 2px 6px; }

    .pdf-details { margin: 30px 0; }
    .pdf-detail-row { margin-bottom: 15px; }
    .pdf-detail-label { font-weight: 700; font-size: 12px; text-transform: uppercase; margin-bottom: 4px; }
    .pdf-detail-value { font-size: 14px; color: #333; }
    .pdf-additional-details { font-size: 14px; color: #333; line-height: 1.6; }
    .pdf-additional-details ul, .pdf-additional-details ol { margin-left: 20px; }

    .rich-editor-content:empty:before {
      content: attr(placeholder);
      color: #999;
      pointer-events: none;
    }

    .pdf-services { margin: 30px 0; }
    .pdf-service-header { background: #000; color: #fff; padding: 15px 20px; font-weight: 600; margin-bottom: 1px; }
    .pdf-service-item { border: 1px solid #eee; border-top: none; padding: 15px 20px; background: #fff; }
    .pdf-service-name { font-weight: 600; margin-bottom: 5px; color: #000; }
    .pdf-service-name .highlight { color: #F5CB5C; }
    .pdf-service-desc { font-size: 12px; color: #666; line-height: 1.5; }
    .pdf-service-desc li { margin-left: 15px; margin-bottom: 3px; }
    .pdf-service-note { font-style: italic; font-size: 11px; color: #999; margin-top: 5px; }

    .pdf-fee { margin: 30px 0; }
    .pdf-fee-label { font-size: 18px; font-weight: 600; color: #000; }
    .pdf-fee-amount { font-size: 32px; font-weight: 700; color: #F5CB5C; }
    .pdf-fee-note { font-size: 11px; color: #666; font-style: italic; margin-top: 10px; }

    .pdf-terms { margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee; }
    .pdf-terms-grid {
      column-count: 2;
      column-gap: 25px;
      font-size: 9px;
      line-height: 1.5;
      color: #666;
    }
    .pdf-term-section {
      break-inside: avoid;
      margin-bottom: 12px;
      display: inline-block;
      width: 100%;
    }
    .pdf-term-section h4 { font-size: 10px; font-weight: 700; color: #000; margin-bottom: 4px; }
    .pdf-term-section p { margin: 0; }

    .pdf-signature { margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee; color: #000; }
    .pdf-sig-row { display: flex; gap: 30px; margin-bottom: 20px; }
    .pdf-sig-field { flex: 1; }
    .pdf-sig-line { border-bottom: 1px solid #000; height: 40px; margin-bottom: 5px; }
    .pdf-sig-label { font-size: 10px; color: #666; }

    .modal-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center;
      z-index: 1000; backdrop-filter: blur(4px);
    }
    .modal { background: #111; border-radius: 12px; max-width: 900px; width: 90%; max-height: 90vh; overflow: auto; border: 1px solid #333; }
    .modal-header { padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    .modal-body { padding: 20px; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #888; }
    .modal-close:hover { color: #fff; }

    .checkbox-wrapper { display: flex; align-items: center; gap: 10px; }
    .checkbox-wrapper input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
    .checkbox-wrapper label { color: #ccc; }

    /* Editable fields in review */
    .editable-section { margin-bottom: 30px; padding: 25px; background: #111; border-radius: 10px; border: 1px solid #222; }
    .editable-section h3 { margin-bottom: 18px; font-size: 14px; color: #fff; font-weight: 600; }
    .editable-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    .editable-row.full { grid-template-columns: 1fr; }
    .editable-field label { display: block; font-size: 11px; font-weight: 600; color: #666; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
    .editable-field input, .editable-field textarea {
      width: 100%; padding: 12px 14px; border: 1px solid #333; border-radius: 6px; font-size: 14px;
      background: #0a0a0a; color: #fff; font-family: 'Inter', sans-serif;
    }
    .editable-field input:focus, .editable-field textarea:focus { border-color: #555; outline: none; }
    .editable-field textarea { min-height: 60px; resize: vertical; }

    .section-divider {
      border: none; border-top: 1px solid #333; margin: 30px 0;
    }

    .no-recommendation {
      background: #111; border: 1px dashed #444; border-radius: 12px;
      padding: 30px; text-align: center; margin-top: 30px; color: #666;
    }

    @media (max-width: 1024px) {
      .main-grid { grid-template-columns: 1fr; }
      .summary-section { position: static; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Data Configuration
    const HOURLY_RATE = 195;
    const TECH_FEE = 299;

    const BRICKS = {
      kickoff: {
        name: 'Kickoff & Measurement Plan',
        desc: 'Review project timeline, objectives, audience insights, goals and team roles. Measurement plan to inform client dashboard and quarterly reporting template.',
        note: '*Does not include conversion validation or implementation',
        defaultHours: { mo1: 37, mo2: 0, mo3: 0, mo4: 0, mo5: 0, mo6: 0, mo7: 0, mo8: 0, mo9: 0, mo10: 0, mo11: 0, mo12: 0 },
        category: 'setup'
      },
      keywordAnalysis: {
        name: 'Keyword Analysis',
        desc: 'Generate keyword list. Prioritize topic hierarchy clusters based on relevancy, volume and competition. Set competitive benchmarks - kw number, volume, CPC of keywords.',
        defaultHours: { mo1: 50, mo2: 0, mo3: 0, mo4: 0, mo5: 0, mo6: 0, mo7: 0, mo8: 0, mo9: 0, mo10: 0, mo11: 0, mo12: 0 },
        category: 'seo'
      },
      digitalAdCreative: {
        name: 'Digital Ad Creation & Landing Page Creative',
        desc: 'Audit & plan for creation & testing of ad copy and visual assets based on campaign plan. Landing page copy and visual asset optimization.',
        note: '*New content creation and landing page implementation to be estimated separately.',
        defaultHours: { mo1: 0, mo2: 50, mo3: 50, mo4: 0, mo5: 25, mo6: 0, mo7: 25, mo8: 0, mo9: 25, mo10: 0, mo11: 25, mo12: 0 },
        category: 'creative'
      },
      channelStrategy: {
        name: 'Channel Strategy, Campaign Setup',
        desc: 'Deliver playbook with audience targeting, messaging strategy, flighting sequence, engagement metric benchmarks, goals & budget allocation. Set up campaigns and measurement for launch.',
        channels: ['Search', 'Social', 'Display', 'Programmatic'],
        defaultHours: { mo1: 0, mo2: 50, mo3: 0, mo4: 0, mo5: 0, mo6: 0, mo7: 0, mo8: 0, mo9: 0, mo10: 0, mo11: 0, mo12: 0 },
        category: 'strategy'
      },
      monthlyManagement: {
        name: 'Monthly Management & Optimization',
        desc: 'Daily/weekly optimization of campaign performance (audience, bids, copy edits, negative kw, geographic). Bi-weekly/monthly discussion of progress & priorities. Real-time access to live dashboard + Quarterly all-hands indepth reporting.',
        note: '*Media cost not included - billed directly from platform to client with no markup.',
        defaultHours: { mo1: 8, mo2: 8, mo3: 28, mo4: 28, mo5: 28, mo6: 28, mo7: 28, mo8: 28, mo9: 28, mo10: 28, mo11: 28, mo12: 28 },
        category: 'management'
      },
      discoverability: {
        name: 'Discoverability & Conversion: Monthly Optimization',
        desc: 'Inbound visibility across search (Google/Bing), user-generated (Reddit, YouTube, reviews), and AI assistants. On-site conversion rate optimization to increase goal completion.',
        defaultHours: { mo1: 30, mo2: 30, mo3: 30, mo4: 30, mo5: 30, mo6: 30, mo7: 30, mo8: 30, mo9: 30, mo10: 30, mo11: 30, mo12: 30 },
        category: 'seo'
      },
      creativeExecution: {
        name: 'Monthly Creative Execution',
        desc: 'Concept, design and copywriting based on client-provided brand direction. Deliver production-ready creative files (may include video, photo, audio, print, OOH, collateral, tradeshow).',
        note: '*Uses existing visual assets. Hard costs for new photo or video creation billed direct.',
        defaultHours: { mo1: 50, mo2: 50, mo3: 50, mo4: 50, mo5: 50, mo6: 50, mo7: 50, mo8: 50, mo9: 50, mo10: 50, mo11: 50, mo12: 50 },
        category: 'creative'
      },
      organicSocialPlaybook: {
        name: 'Organic Social Media Playbook',
        desc: 'Analyze existing social efforts against competitors. Develop editorial strategy for up to 4 channels: Facebook, Instagram, Twitter, and LinkedIn.',
        defaultHours: { mo1: 75, mo2: 0, mo3: 0, mo4: 0, mo5: 0, mo6: 0, mo7: 0, mo8: 0, mo9: 0, mo10: 0, mo11: 0, mo12: 0 },
        category: 'social'
      },
      socialContent: {
        name: 'Social Content Creation: Visuals & Writing',
        desc: 'Deliver visual infographics, stylized images, typography/designs and writing for foundational organic and paid social media for 4 channels.',
        note: '*Content posting and social media community engagement to be led by client team',
        defaultHours: { mo1: 0, mo2: 33, mo3: 33, mo4: 33, mo5: 33, mo6: 33, mo7: 33, mo8: 33, mo9: 33, mo10: 33, mo11: 33, mo12: 33 },
        category: 'social'
      },
      contentStrategy: {
        name: 'Content Strategy & Editorial Calendar',
        desc: 'Develop content strategy and editorial calendar aligned with business objectives and audience needs.',
        defaultHours: { mo1: 0, mo2: 0, mo3: 0, mo4: 0, mo5: 0, mo6: 0, mo7: 0, mo8: 0, mo9: 0, mo10: 0, mo11: 0, mo12: 0 },
        category: 'strategy'
      }
    };

    const KITS = [
      {
        id: 'acquisition',
        name: 'Acquisition only - SEM+SEO+CRO+Analytics',
        desc: 'Focus on paid search, organic search, and conversion rate optimization',
        bricks: ['kickoff', 'keywordAnalysis', 'channelStrategy', 'monthlyManagement', 'discoverability'],
        channels: ['Search'],
        // Matches: paidSearch + SEO
        matchServices: ['paidSearch', 'seo']
      },
      {
        id: 'awareness',
        name: 'Awareness only - Creative+Paid Social, Prog, CTV',
        desc: 'Focus on brand awareness through social, programmatic, and connected TV',
        bricks: ['kickoff', 'keywordAnalysis', 'digitalAdCreative', 'channelStrategy', 'monthlyManagement'],
        channels: ['Social', 'Display', 'Programmatic'],
        // Matches: paidAwareness + creative
        matchServices: ['paidAwareness', 'creative']
      },
      {
        id: 'step1plus2',
        name: 'Step 1+2 - Acquisition+Awareness - Paid + Creative + SEO',
        desc: 'Combined acquisition and awareness campaigns with creative services',
        bricks: ['kickoff', 'keywordAnalysis', 'digitalAdCreative', 'channelStrategy', 'monthlyManagement', 'discoverability'],
        channels: ['Search', 'Social', 'Display', 'Programmatic'],
        // Matches: paidSearch + SEO + paidAwareness OR paidSearch + SEO + creative
        matchServices: ['paidSearch', 'seo', 'paidAwareness']
      },
      {
        id: 'kitchenSink',
        name: 'Step 1+2+3 - Kitchen Sink (Full Service)',
        desc: 'Complete marketing solution including acquisition, awareness, and conversion support',
        bricks: ['kickoff', 'keywordAnalysis', 'digitalAdCreative', 'channelStrategy', 'monthlyManagement', 'discoverability', 'creativeExecution'],
        channels: ['Search', 'Social', 'Display', 'Programmatic'],
        // Matches: all services or paidSearch + SEO + paidAwareness + creative
        matchServices: ['paidSearch', 'seo', 'paidAwareness', 'creative']
      },
      {
        id: 'paidMediaCreative',
        name: 'Paid Media + Creative',
        desc: 'Paid media management with creative development',
        bricks: ['kickoff', 'keywordAnalysis', 'digitalAdCreative', 'channelStrategy', 'monthlyManagement'],
        channels: ['Search', 'Social', 'Display', 'Programmatic'],
        // Matches: paidSearch + creative OR paidAwareness + paidSearch
        matchServices: ['paidSearch', 'creative']
      },
      {
        id: 'ownedCreative',
        name: 'Owned Media: Creative-only (Enterprise)',
        desc: 'Focus on owned media creative development and execution',
        bricks: ['kickoff', 'keywordAnalysis', 'digitalAdCreative', 'creativeExecution'],
        channels: [],
        // Matches: creative only
        matchServices: ['creative']
      },
      {
        id: 'ownedSEO',
        name: 'Owned Media: Discoverability - SEO+CRO (Enterprise)',
        desc: 'Focus on organic search visibility and conversion optimization',
        bricks: ['kickoff', 'keywordAnalysis', 'contentStrategy', 'discoverability'],
        channels: [],
        // Matches: SEO only
        matchServices: ['seo']
      },
      {
        id: 'organicSocial',
        name: 'Organic Social - Add-on',
        desc: 'Organic social media strategy and content creation (not standalone)',
        bricks: ['organicSocialPlaybook', 'socialContent'],
        channels: [],
        // Matches: other (social)
        matchServices: ['other']
      }
    ];

    // Service options for intake
    const SERVICE_OPTIONS = [
      { id: 'paidSearch', label: 'Paid Search', desc: 'SEM, Google Ads, Bing Ads' },
      { id: 'seo', label: 'SEO', desc: 'Organic search, CRO, discoverability' },
      { id: 'paidAwareness', label: 'Paid Awareness', desc: 'Social ads, programmatic, CTV' },
      { id: 'creative', label: 'Creative', desc: 'Digital ad creation, landing pages' },
      { id: 'other', label: 'Other', desc: 'Organic social, custom services' },
    ];

    // Function to recommend a kit based on selected services
    function getRecommendedKit(selectedServices) {
      if (selectedServices.length === 0) return null;

      const selected = new Set(selectedServices);

      // If ONLY "other" is selected, return null for custom build
      if (selected.size === 1 && selected.has('other')) {
        return null;
      }

      // Scoring logic - find the kit that best matches
      let bestKit = null;
      let bestScore = -1;

      for (const kit of KITS) {
        const kitServices = new Set(kit.matchServices);

        // Calculate match score
        let matchCount = 0;
        let extraCount = 0;

        for (const service of selected) {
          if (kitServices.has(service)) {
            matchCount++;
          }
        }

        for (const service of kitServices) {
          if (!selected.has(service)) {
            extraCount++;
          }
        }

        // Score = matches - (extras * 0.5) - need all selected to be covered
        const coversAll = [...selected].every(s => kitServices.has(s) || s === 'other');
        const score = coversAll ? (matchCount * 2) - extraCount : -100;

        if (score > bestScore) {
          bestScore = score;
          bestKit = kit;
        }
      }

      // Special case handling
      if (selected.has('paidSearch') && selected.has('seo') && !selected.has('paidAwareness') && !selected.has('creative')) {
        return KITS.find(k => k.id === 'acquisition');
      }

      if (selected.has('paidAwareness') && selected.has('creative') && !selected.has('paidSearch') && !selected.has('seo')) {
        return KITS.find(k => k.id === 'awareness');
      }

      if (selected.size === 1 && selected.has('seo')) {
        return KITS.find(k => k.id === 'ownedSEO');
      }

      if (selected.size === 1 && selected.has('creative')) {
        return KITS.find(k => k.id === 'ownedCreative');
      }

      if (selected.size === 1 && selected.has('paidSearch')) {
        return KITS.find(k => k.id === 'acquisition');
      }

      if (selected.size === 1 && selected.has('paidAwareness')) {
        return KITS.find(k => k.id === 'awareness');
      }

      if (selected.has('paidSearch') && selected.has('seo') && (selected.has('paidAwareness') || selected.has('creative'))) {
        if (selected.has('paidAwareness') && selected.has('creative')) {
          return KITS.find(k => k.id === 'kitchenSink');
        }
        return KITS.find(k => k.id === 'step1plus2');
      }

      if (selected.has('paidSearch') && selected.has('creative') && !selected.has('seo')) {
        return KITS.find(k => k.id === 'paidMediaCreative');
      }

      return bestKit;
    }

    // Check if this is a custom build (only "other" selected)
    function isCustomBuild(selectedServices) {
      return selectedServices.length === 1 && selectedServices.includes('other');
    }

    // Get add-on bricks not in the recommended kit (or all bricks for custom build)
    function getAvailableAddons(kitId, isCustom) {
      // For custom build, return all bricks
      if (isCustom) {
        return Object.entries(BRICKS)
          .map(([id, brick]) => ({ id, ...brick }));
      }

      if (!kitId) return [];
      const kit = KITS.find(k => k.id === kitId);
      if (!kit) return [];

      const kitBricks = new Set(kit.bricks);
      return Object.entries(BRICKS)
        .filter(([id]) => !kitBricks.has(id))
        .map(([id, brick]) => ({ id, ...brick }));
    }

    // Main App Component
    function App() {
      const [activeTab, setActiveTab] = useState('intake');
      const [clientInfo, setClientInfo] = useState({
        name: '',
        date: new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' }),
        additionalDetails: ''
      });
      const editorRef = React.useRef(null);
      const [selectedServices, setSelectedServices] = useState([]);
      const [selectedAddons, setSelectedAddons] = useState([]);
      const [isCustomizingKit, setIsCustomizingKit] = useState(false);
      const [excludedKitBricks, setExcludedKitBricks] = useState([]);
      const [selectedKit, setSelectedKit] = useState(null);
      const [selectedBricks, setSelectedBricks] = useState({});
      const [brickHours, setBrickHours] = useState({});
      const [includeTechFee, setIncludeTechFee] = useState(true);
      const [selectedChannels, setSelectedChannels] = useState(['Search', 'Social', 'Display', 'Programmatic']);
      const [clientNameError, setClientNameError] = useState(false);
      const clientNameRef = React.useRef(null);
      const [showKitSelector, setShowKitSelector] = useState(false);
      const [showBricksCustomizer, setShowBricksCustomizer] = useState(false);
      const [showCostDetails, setShowCostDetails] = useState(false);

      const recommendedKit = getRecommendedKit(selectedServices);
      const customBuild = isCustomBuild(selectedServices);
      const availableAddons = getAvailableAddons(recommendedKit?.id, customBuild);

      // Toggle service selection
      const toggleService = (serviceId) => {
        setSelectedServices(prev =>
          prev.includes(serviceId)
            ? prev.filter(s => s !== serviceId)
            : [...prev, serviceId]
        );
        setSelectedAddons([]); // Reset addons when services change
        setIsCustomizingKit(false); // Reset customization when services change
        setExcludedKitBricks([]); // Reset excluded bricks
      };

      // Toggle kit brick exclusion (for customizing kit)
      const toggleKitBrick = (brickId) => {
        setExcludedKitBricks(prev =>
          prev.includes(brickId)
            ? prev.filter(b => b !== brickId)
            : [...prev, brickId]
        );
      };

      // Toggle addon selection
      const toggleAddon = (addonId) => {
        setSelectedAddons(prev =>
          prev.includes(addonId)
            ? prev.filter(a => a !== addonId)
            : [...prev, addonId]
        );
      };

      // Proceed with recommended kit
      const proceedWithKit = () => {
        if (!recommendedKit) return;

        // Validate client name
        if (!clientInfo.name.trim()) {
          setClientNameError(true);
          clientNameRef.current?.focus();
          clientNameRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }

        setSelectedKit(recommendedKit.id);

        // Initialize bricks from kit + addons (excluding any removed bricks)
        const newBricks = {};
        const newHours = {};

        recommendedKit.bricks.forEach(brickId => {
          if (!excludedKitBricks.includes(brickId)) {
            newBricks[brickId] = true;
            newHours[brickId] = { ...BRICKS[brickId].defaultHours };
          }
        });

        selectedAddons.forEach(addonId => {
          newBricks[addonId] = true;
          newHours[addonId] = { ...BRICKS[addonId].defaultHours };
        });

        setSelectedBricks(newBricks);
        setBrickHours(newHours);
        setSelectedChannels(recommendedKit.channels || []);
        setActiveTab('configure');
      };

      // Proceed with custom build (only selected addons, no kit)
      const proceedWithCustomBuild = () => {
        if (selectedAddons.length === 0) return;

        // Validate client name
        if (!clientInfo.name.trim()) {
          setClientNameError(true);
          clientNameRef.current?.focus();
          clientNameRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }

        setSelectedKit('custom'); // Use 'custom' as a special kit ID

        // Initialize bricks from selected addons only
        const newBricks = {};
        const newHours = {};

        selectedAddons.forEach(addonId => {
          newBricks[addonId] = true;
          newHours[addonId] = { ...BRICKS[addonId].defaultHours };
        });

        setSelectedBricks(newBricks);
        setBrickHours(newHours);
        setSelectedChannels([]);
        setActiveTab('configure');
      };

      // Initialize brick hours when kit changes manually
      useEffect(() => {
        if (selectedKit && activeTab === 'configure') {
          // Skip initialization for custom builds - they're already set up by proceedWithCustomBuild
          if (selectedKit === 'custom') return;

          const kit = KITS.find(k => k.id === selectedKit);
          if (kit && Object.keys(selectedBricks).length === 0) {
            const newBricks = {};
            const newHours = {};

            kit.bricks.forEach(brickId => {
              newBricks[brickId] = true;
              newHours[brickId] = { ...BRICKS[brickId].defaultHours };
            });

            setSelectedBricks(newBricks);
            setBrickHours(newHours);
            setSelectedChannels(kit.channels || []);
          }
        }
      }, [selectedKit, activeTab]);

      const toggleBrick = (brickId) => {
        setSelectedBricks(prev => ({
          ...prev,
          [brickId]: !prev[brickId]
        }));

        if (!selectedBricks[brickId]) {
          setBrickHours(prev => ({
            ...prev,
            [brickId]: { ...BRICKS[brickId].defaultHours }
          }));
        }
      };

      const updateBrickHours = (brickId, month, value) => {
        setBrickHours(prev => ({
          ...prev,
          [brickId]: {
            ...prev[brickId],
            [month]: parseInt(value) || 0
          }
        }));
      };

      const calculateTotals = () => {
        let monthlyHours = { mo1: 0, mo2: 0, mo3: 0, mo4: 0, mo5: 0, mo6: 0, mo7: 0, mo8: 0, mo9: 0, mo10: 0, mo11: 0, mo12: 0 };

        Object.entries(selectedBricks).forEach(([brickId, included]) => {
          if (included && brickHours[brickId]) {
            Object.keys(monthlyHours).forEach(month => {
              monthlyHours[month] += brickHours[brickId][month] || 0;
            });
          }
        });

        const monthlyFees = {};
        const techFee = includeTechFee ? TECH_FEE : 0;

        Object.keys(monthlyHours).forEach(month => {
          const serviceFee = monthlyHours[month] * HOURLY_RATE;
          monthlyFees[month] = serviceFee + techFee;
        });

        const ongoingMonths = ['mo2', 'mo3', 'mo4', 'mo5', 'mo6', 'mo7', 'mo8', 'mo9', 'mo10', 'mo11', 'mo12'];
        const avgOngoing = ongoingMonths.reduce((sum, m) => sum + monthlyFees[m], 0) / ongoingMonths.length;

        return {
          monthlyHours,
          monthlyFees,
          techFee,
          avgOngoingFee: Math.round(avgOngoing),
          firstMonthFee: monthlyFees.mo1
        };
      };

      const totals = calculateTotals();

      const exportPDF = () => {
        const element = document.getElementById('pdf-content');
        const opt = {
          margin: [0.5, 0.5],
          filename: `${clientInfo.name || 'Client'}-SOW-${new Date().toISOString().split('T')[0]}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save();
      };

      const formatCurrency = (amount) => {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(Math.round(amount));
      };

      // Rich text editor commands
      const execCommand = (command, value = null) => {
        document.execCommand(command, false, value);
        editorRef.current?.focus();
      };

      const handleEditorInput = () => {
        if (editorRef.current) {
          setClientInfo(prev => ({ ...prev, additionalDetails: editorRef.current.innerHTML }));
        }
      };

      const canProceedToConfig = clientInfo.name && recommendedKit;

      return (
        <div className="app-container">
          <header className="header">
            <div className="header-left">
              <div className="header-logo">Native Digital<span>|</span></div>
              <h1>SOW Cost Estimator</h1>
            </div>
          </header>

          <div className="tabs">
            <div
              className={`tab ${activeTab === 'intake' ? 'active' : ''}`}
              onClick={() => setActiveTab('intake')}
            >
              1. Client Intake
            </div>
            <div
              className={`tab ${activeTab === 'configure' ? 'active' : ''} ${!selectedKit ? 'disabled' : ''}`}
              onClick={() => selectedKit && setActiveTab('configure')}
            >
              2. Configure Services
            </div>
            <div
              className={`tab ${activeTab === 'review' ? 'active' : ''} ${!selectedKit ? 'disabled' : ''}`}
              onClick={() => selectedKit && setActiveTab('review')}
            >
              3. Review & Export
            </div>
          </div>

          {/* STEP 1: CLIENT INTAKE */}
          {activeTab === 'intake' && (
            <div className="main-grid">
              <div className="panel">
                <div className="panel-header">
                  <h2>Client Information</h2>
                </div>
                <div className="panel-body">
                  <div className="form-group">
                    <label>Client Name *</label>
                    <input
                      ref={clientNameRef}
                      type="text"
                      value={clientInfo.name}
                      onChange={(e) => {
                        setClientInfo({...clientInfo, name: e.target.value});
                        if (e.target.value.trim()) setClientNameError(false);
                      }}
                      placeholder="e.g., Lectric, Mint Mobile, GoPro"
                      style={clientNameError ? { borderColor: '#ef4444', boxShadow: '0 0 0 2px rgba(239, 68, 68, 0.25)' } : {}}
                    />
                    {clientNameError && (
                      <p style={{ color: '#ef4444', fontSize: 12, marginTop: 8, fontWeight: 500 }}>Client name is required to proceed.</p>
                    )}
                  </div>

                  <hr className="section-divider" />

                  <div className="form-group">
                    <label>What services are you wanting to estimate?</label>
                    <p style={{ fontSize: 12, color: '#666', marginBottom: 10 }}>Select all that apply</p>
                    <div className="service-toggles">
                      {SERVICE_OPTIONS.map(service => (
                        <div
                          key={service.id}
                          className={`service-toggle ${selectedServices.includes(service.id) ? 'active' : ''}`}
                          onClick={() => toggleService(service.id)}
                        >
                          {service.label}
                        </div>
                      ))}
                    </div>
                  </div>

                  {recommendedKit && (
                    <div className="recommendation-card">
                      <h3>âœ“ Recommended Kit</h3>
                      <div className="kit-name">{recommendedKit.name}</div>
                      <div className="kit-desc">{recommendedKit.desc}</div>

                      {!isCustomizingKit ? (
                        <>
                          <div className="included-services">
                            <h4>Included Services</h4>
                            {recommendedKit.bricks.map(brickId => (
                              <span key={brickId} className="service-tag">{BRICKS[brickId].name}</span>
                            ))}
                          </div>

                          <div className="btn-group" style={{ marginTop: 20, alignItems: 'center' }}>
                            <button
                              className="btn btn-success"
                              onClick={proceedWithKit}
                            >
                              Proceed with This Kit â†’
                            </button>
                            <button
                              onClick={() => setIsCustomizingKit(true)}
                              style={{ background: 'none', border: 'none', color: '#888', fontSize: 13, cursor: 'pointer', textDecoration: 'underline' }}
                            >
                              Customize this Kit
                            </button>
                          </div>
                        </>
                      ) : (
                        <>
                          <div className="included-services" style={{ marginTop: 15 }}>
                            <h4 style={{ marginBottom: 12, color: '#888' }}>Select services to include:</h4>
                            {recommendedKit.bricks.map(brickId => (
                              <div
                                key={brickId}
                                className={`addon-item ${!excludedKitBricks.includes(brickId) ? 'selected' : ''}`}
                                onClick={() => toggleKitBrick(brickId)}
                                style={{ marginBottom: 8 }}
                              >
                                <div className="addon-info">
                                  <div className="addon-name">{BRICKS[brickId].name}</div>
                                </div>
                                <input
                                  type="checkbox"
                                  checked={!excludedKitBricks.includes(brickId)}
                                  onChange={() => toggleKitBrick(brickId)}
                                />
                              </div>
                            ))}
                          </div>
                          {excludedKitBricks.length > 0 && (
                            <p style={{ fontSize: 12, color: '#666', marginTop: 10 }}>
                              {excludedKitBricks.length} service{excludedKitBricks.length > 1 ? 's' : ''} will be removed from the kit.
                            </p>
                          )}
                          <div className="btn-group" style={{ marginTop: 15 }}>
                            <button
                              className="btn btn-success"
                              onClick={proceedWithKit}
                              disabled={excludedKitBricks.length === recommendedKit.bricks.length}
                            >
                              Proceed with Customized Kit â†’
                            </button>
                          </div>
                          <div style={{ marginTop: 12, textAlign: 'center' }}>
                            <button
                              onClick={() => { setIsCustomizingKit(false); setExcludedKitBricks([]); }}
                              style={{ background: 'none', border: 'none', color: '#888', fontSize: 13, cursor: 'pointer', textDecoration: 'underline' }}
                            >
                              Cancel customization
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  )}

                  {customBuild && (
                    <div className="custom-build-card">
                      <h3>ðŸ›  Custom Build</h3>
                      <div className="kit-name">Build Your Own Scope</div>
                      <div className="kit-desc">Select individual services from the add-ons panel to create a custom scope of work tailored to your specific needs.</div>

                      <div className="btn-group" style={{ marginTop: 20 }}>
                        <button
                          className="btn btn-primary"
                          onClick={proceedWithCustomBuild}
                          disabled={selectedAddons.length === 0}
                        >
                          Proceed with Custom Build â†’
                        </button>
                      </div>
                      {selectedAddons.length === 0 && (
                        <p style={{ fontSize: 12, color: '#666', marginTop: 10 }}>Select at least one service from the add-ons panel to proceed.</p>
                      )}
                    </div>
                  )}

                  {selectedServices.length > 0 && !recommendedKit && !customBuild && (
                    <div className="no-recommendation">
                      <p>No exact kit match found. Please adjust your selections or proceed to configure services manually.</p>
                    </div>
                  )}

                  {selectedServices.length === 0 && (
                    <div className="no-recommendation">
                      <p>Select services above to see a recommended kit.</p>
                    </div>
                  )}
                </div>
              </div>

              <div className="panel">
                <div className="panel-header">
                  <h2>{customBuild ? 'Select Services' : 'Optional Add-ons'}</h2>
                </div>
                <div className="panel-body">
                  {customBuild ? (
                    <>
                      <p style={{ fontSize: 13, color: '#666', marginBottom: 15 }}>
                        Select the services you want to include in your custom scope:
                      </p>
                      {availableAddons.map(addon => (
                        <div
                          key={addon.id}
                          className={`addon-item ${selectedAddons.includes(addon.id) ? 'selected' : ''}`}
                          onClick={() => toggleAddon(addon.id)}
                        >
                          <div className="addon-info">
                            <div className="addon-name">{addon.name}</div>
                            <div className="addon-desc">{addon.desc.substring(0, 80)}...</div>
                          </div>
                          <input
                            type="checkbox"
                            checked={selectedAddons.includes(addon.id)}
                            onChange={() => toggleAddon(addon.id)}
                          />
                        </div>
                      ))}
                    </>
                  ) : recommendedKit ? (
                    <>
                      <p style={{ fontSize: 13, color: '#666', marginBottom: 15 }}>
                        These services are not included in the recommended kit but can be added:
                      </p>
                      {availableAddons.length > 0 ? (
                        availableAddons.map(addon => (
                          <div
                            key={addon.id}
                            className={`addon-item ${selectedAddons.includes(addon.id) ? 'selected' : ''}`}
                            onClick={() => toggleAddon(addon.id)}
                          >
                            <div className="addon-info">
                              <div className="addon-name">{addon.name}</div>
                              <div className="addon-desc">{addon.desc.substring(0, 80)}...</div>
                            </div>
                            <input
                              type="checkbox"
                              checked={selectedAddons.includes(addon.id)}
                              onChange={() => toggleAddon(addon.id)}
                            />
                          </div>
                        ))
                      ) : (
                        <p style={{ color: '#999' }}>All services are included in the recommended kit.</p>
                      )}
                    </>
                  ) : (
                    <p style={{ color: '#999' }}>Select services to see available add-ons.</p>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* STEP 2: CONFIGURE SERVICES */}
          {activeTab === 'configure' && (
            <div className="main-grid">
              <div className="panel">
                <div className="panel-header">
                  <h2>Selected Kit: {selectedKit === 'custom' ? 'Custom Build' : KITS.find(k => k.id === selectedKit)?.name}</h2>
                </div>
                <div className="panel-body">
                  <div className="checkbox-wrapper">
                    <input
                      type="checkbox"
                      id="techFee"
                      checked={includeTechFee}
                      onChange={(e) => setIncludeTechFee(e.target.checked)}
                    />
                    <label htmlFor="techFee">Include Tech Fee (+$299/mo for software licenses & tools)</label>
                  </div>

                  <div style={{ marginTop: 25 }}>
                    <div
                      className={`collapsible-header ${showKitSelector ? 'open' : ''}`}
                      onClick={() => setShowKitSelector(!showKitSelector)}
                    >
                      <h3>Change Kit</h3>
                      <span className="toggle-icon">â–¼</span>
                    </div>
                    <div className={`collapsible-content ${showKitSelector ? 'open' : ''}`}>
                      <div className="kit-selector">
                        {KITS.map(kit => (
                          <div
                            key={kit.id}
                            className={`kit-option ${selectedKit === kit.id ? 'selected' : ''} ${recommendedKit?.id === kit.id ? 'recommended' : ''}`}
                            onClick={() => {
                              setSelectedKit(kit.id);
                              const newBricks = {};
                              const newHours = {};
                              kit.bricks.forEach(brickId => {
                                newBricks[brickId] = true;
                                newHours[brickId] = { ...BRICKS[brickId].defaultHours };
                              });
                              setSelectedBricks(newBricks);
                              setBrickHours(newHours);
                              setSelectedChannels(kit.channels || []);
                            }}
                          >
                            <h3>
                              {kit.name}
                              {recommendedKit?.id === kit.id && <span className="recommended-badge">Recommended</span>}
                            </h3>
                            <p>{kit.desc}</p>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  <div style={{ marginTop: 15 }}>
                    <div
                      className={`collapsible-header ${showBricksCustomizer ? 'open' : ''}`}
                      onClick={() => setShowBricksCustomizer(!showBricksCustomizer)}
                    >
                      <h3>Customize Services (Bricks)</h3>
                      <span className="toggle-icon">â–¼</span>
                    </div>
                    <div className={`collapsible-content ${showBricksCustomizer ? 'open' : ''}`}>
                      <div className="brick-list">
                        {Object.entries(BRICKS).map(([brickId, brick]) => (
                          <div
                            key={brickId}
                            className={`brick-item ${selectedBricks[brickId] ? 'included' : 'excluded'}`}
                          >
                            <div className="brick-info">
                              <div className="brick-name">{brick.name}</div>
                              <div className="brick-desc">{brick.desc.substring(0, 100)}...</div>
                            </div>
                            <div className="brick-toggle">
                              <input
                                type="checkbox"
                                checked={selectedBricks[brickId] || false}
                                onChange={() => toggleBrick(brickId)}
                              />
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div className="panel summary-section">
                <div className="panel-header">
                  <h2>Cost Summary</h2>
                </div>
                <div className="panel-body">
                  <div className="summary-row total" style={{ marginTop: 0, paddingTop: 0, borderTop: 'none' }}>
                    <span className="label">Avg Ongoing Monthly Fee (Mo 2-12)</span>
                    <span>{formatCurrency(totals.avgOngoingFee)}</span>
                  </div>

                  <div style={{ marginTop: 20 }}>
                    <div
                      className={`collapsible-header ${showCostDetails ? 'open' : ''}`}
                      onClick={() => setShowCostDetails(!showCostDetails)}
                    >
                      <h3>View Cost Details</h3>
                      <span className="toggle-icon">â–¼</span>
                    </div>
                    <div className={`collapsible-content ${showCostDetails ? 'open' : ''}`}>
                      <h4 style={{ marginBottom: 15, marginTop: 10 }}>Monthly Hours by Service</h4>
                      {Object.entries(selectedBricks).filter(([_, included]) => included).map(([brickId]) => (
                        <div key={brickId} style={{ marginBottom: 20 }}>
                          <div style={{ fontSize: 13, fontWeight: 500, marginBottom: 8 }}>{BRICKS[brickId].name}</div>
                          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gap: 6 }}>
                            {['mo1', 'mo2', 'mo3', 'mo4', 'mo5', 'mo6', 'mo7', 'mo8', 'mo9', 'mo10', 'mo11', 'mo12'].map(month => (
                              <div key={month}>
                                <div style={{ fontSize: 9, color: '#666', marginBottom: 3, textAlign: 'center' }}>
                                  {month.replace('mo', '')}
                                </div>
                                <input
                                  type="number"
                                  min="0"
                                  value={brickHours[brickId]?.[month] || 0}
                                  onChange={(e) => updateBrickHours(brickId, month, e.target.value)}
                                  style={{ width: '100%', padding: 6, textAlign: 'center', fontSize: 12 }}
                                />
                              </div>
                            ))}
                          </div>
                        </div>
                      ))}

                      <div style={{ marginTop: 30, paddingTop: 20, borderTop: '2px solid #eee' }}>
                        <h4 style={{ marginBottom: 15 }}>Monthly Fee Breakdown</h4>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 8 }}>
                          {['mo1', 'mo2', 'mo3', 'mo4', 'mo5', 'mo6', 'mo7', 'mo8', 'mo9', 'mo10', 'mo11', 'mo12'].map(month => (
                            <div key={month} style={{ display: 'flex', justifyContent: 'space-between', padding: '8px 0', borderBottom: '1px solid #eee' }}>
                              <span style={{ color: '#666', fontSize: 13 }}>Mo {month.replace('mo', '')}</span>
                              <span style={{ fontSize: 13 }}>{formatCurrency(totals.monthlyFees[month])}</span>
                            </div>
                          ))}
                        </div>
                        <div className="summary-row" style={{ marginTop: 15 }}>
                          <span className="label">Tech Fee (per month)</span>
                          <span>{includeTechFee ? formatCurrency(TECH_FEE) : '$0'}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="btn-group">
                    <button className="btn btn-outline" onClick={() => setActiveTab('intake')}>
                      â† Back
                    </button>
                    <button className="btn btn-primary" onClick={() => setActiveTab('review')}>
                      Next: Review & Export â†’
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* STEP 3: REVIEW & EXPORT */}
          {activeTab === 'review' && (
            <div>
              <div className="panel" style={{ marginBottom: 20 }}>
                <div className="panel-header" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <h2>SOW Preview</h2>
                  <div className="btn-group" style={{ margin: 0 }}>
                    <button className="btn btn-outline" onClick={() => setActiveTab('configure')}>
                      â† Edit Services
                    </button>
                    <button className="btn btn-primary" onClick={exportPDF}>
                      Export to PDF
                    </button>
                  </div>
                </div>
              </div>

              {/* Editable Client Details Section */}
              <div className="editable-section">
                <h3>Client Details (Edit below - these will appear in the PDF)</h3>
                <div className="editable-row">
                  <div className="editable-field">
                    <label>Client Name *</label>
                    <input
                      type="text"
                      value={clientInfo.name}
                      onChange={(e) => setClientInfo({...clientInfo, name: e.target.value})}
                      placeholder="e.g., Lectric, Mint Mobile, GoPro"
                    />
                  </div>
                  <div className="editable-field">
                    <label>SOW Date</label>
                    <input
                      type="text"
                      value={clientInfo.date}
                      onChange={(e) => setClientInfo({...clientInfo, date: e.target.value})}
                    />
                  </div>
                </div>
                <div className="editable-row full">
                  <div className="editable-field">
                    <label>Additional Details</label>
                    <div className="rich-editor-toolbar">
                      <button type="button" onClick={() => execCommand('bold')} title="Bold"><b>B</b></button>
                      <button type="button" onClick={() => execCommand('italic')} title="Italic"><i>I</i></button>
                      <button type="button" onClick={() => execCommand('underline')} title="Underline"><u>U</u></button>
                      <button type="button" onClick={() => execCommand('hiliteColor', '#F5CB5C')} title="Highlight">ðŸ–</button>
                      <select onChange={(e) => { execCommand('fontSize', e.target.value); e.target.value = ''; }} defaultValue="">
                        <option value="" disabled>Size</option>
                        <option value="1">Small</option>
                        <option value="3">Normal</option>
                        <option value="5">Large</option>
                        <option value="7">X-Large</option>
                      </select>
                      <button type="button" onClick={() => execCommand('insertUnorderedList')} title="Bullet List">â€¢ List</button>
                      <button type="button" onClick={() => execCommand('insertOrderedList')} title="Numbered List">1. List</button>
                      <button type="button" onClick={() => execCommand('removeFormat')} title="Clear Formatting">Clear</button>
                    </div>
                    <div
                      ref={editorRef}
                      className="rich-editor-content"
                      contentEditable
                      onInput={handleEditorInput}
                      dangerouslySetInnerHTML={{ __html: clientInfo.additionalDetails }}
                      placeholder="Add any additional details about the client, mission, industries, decision makers, solution, funnel flow, milestones, etc."
                    />
                  </div>
                </div>
              </div>

              {/* PDF Content */}
              <div style={{ background: '#1a1a1a', padding: '30px', borderRadius: '12px', border: '1px solid #333' }}>
              <div id="pdf-content">
                <div className="pdf-header">
                  <div className="pdf-logo">Native Digital</div>
                  <div className="pdf-title">SCOPE OF WORK</div>
                  <div className="pdf-client">{clientInfo.name || '[Client Name]'}</div>
                  <div className="pdf-date">{clientInfo.date}</div>
                </div>

                {clientInfo.additionalDetails && (
                  <div className="pdf-details">
                    <div
                      className="pdf-additional-details"
                      dangerouslySetInnerHTML={{ __html: clientInfo.additionalDetails }}
                    />
                  </div>
                )}

                <div className="pdf-services">
                  <div className="pdf-service-header">{clientInfo.name || 'Client'}</div>

                  {Object.entries(selectedBricks).filter(([_, included]) => included).map(([brickId]) => {
                    const brick = BRICKS[brickId];

                    return (
                      <div className="pdf-service-item" key={brickId}>
                        <div className="pdf-service-name">
                          {brick.name}
                          {brick.channels && selectedChannels.length > 0 && (
                            <span className="highlight"> ({selectedChannels.join(', ')})</span>
                          )}
                        </div>
                        <div className="pdf-service-desc">
                          {brick.desc.split('. ').map((sentence, i) => (
                            <div key={i}>- {sentence}{sentence.endsWith('.') ? '' : '.'}</div>
                          ))}
                        </div>
                        {brick.note && <div className="pdf-service-note">{brick.note}</div>}
                      </div>
                    );
                  })}
                </div>

                <div className="pdf-fee">
                  <div className="pdf-fee-label">Monthly Fee</div>
                  <div className="pdf-fee-amount">{formatCurrency(totals.avgOngoingFee)}/mo</div>
                  <div className="pdf-fee-note">
                    Total fee includes ${TECH_FEE}/mo for technology software licenses, platforms, and tools essential for maximizing campaign performance and data management.
                    <br/><br/>
                    *Not included: Identity Resolution to connect, unify, and activate customer data across channels. Data pricing to be provided based on usage requirements.
                  </div>
                </div>

                <div className="pdf-terms">
                  <div className="pdf-terms-grid">
                    <div className="pdf-term-section">
                      <h4>Ownership</h4>
                      <p>Consultant will provide a finished product(s) to the Client in the form of digital documents and asset files. These files become the exclusive property of the Client upon acceptance of delivery. The finished product(s) may depend on objects and other third-party utilities that are the property of their respective owners. No rights to these dependencies are expressed or implied. Additional licensing may be required with third-party assets.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Independent Contractors</h4>
                      <p>Contractors may be used for areas of work that fall outside of Consultant's offerings. Consultant retains the right to subcontract any portion of the Contract.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Response Time</h4>
                      <p>Within the duration of this Agreement Consultant will make every effort to reply to inquiries within one (1) business days, except where Client has been previously notified of a period of limited availability. Client shall assign and provide a day-to-day marketing point-of-contact employee who will oversee the marketing activities that is a non-founder with Consultant prior to project kickoff.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Dependencies</h4>
                      <p>In the event that any aspect of this Agreement is dependent on a separate third party or the Client's team, the quality and punctuality of the finished product(s) may be subject to said party's ability to meet the required timelines and/or level of quality. Consultant is not responsible for any delay or defect caused by separate third party or the Client's teams.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Backups</h4>
                      <p>Consultant maintains internal backups of active project files. This backup system is not intended as a solution for The Client, rather as a code archive through the duration of this Agreement. The Client is solely responsible for the backup and restoration of the finished product(s) and any associated data.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Digital Paid Media Hard Costs</h4>
                      <p>The estimated digital paid media hard costs provided in this Agreement are based on current market conditions, industry trends, and our best judgment at the time of preparation. Digital advertising costs can be subject to various factors beyond our control, including but not limited to fluctuations in advertising platform algorithms, bidding strategies, competition, and market dynamics. Due to inherent variables, actual hard costs associated with digital paid media campaigns may vary. Estimated hard costs provided herein are intended as a guideline and may be subject to adjustment. In consideration of the factors outlined above, the Client agrees to pay an amount equal to 105% of the media budget. A contingency budget of 5% shall be allocated to cover potential overages and will be reconciled every six months from the date on which the Consultant assumes responsibility for the first channel campaign. Following each six month reconciliation, If actual media expenditures exceed 105% of the budgeted amount, the Consultant shall issue a credit on the next billing cycle for the difference between the actual spend and 105% of the invoiced amount. Budgets for multi-location campaigns shall be assessed in aggregate rather than on an individual location basis. Client shall contract and pay for media platform services directly with the provider thereof. In the event Client will be unable to make such payment directly, Client and Consultant shall confer and if agreed in writing by Client and Consultant (such agreement to be in Consultant's sole discretion), Consultant shall make such payment on behalf of Client. In such event, Client shall pay Consultant the amount due to such providers before such media can run, and the terms for these invoices will be net due upon receipt. In the event Client fails to make such payment, Consultant shall have no obligation to run such media and/or make any payment therefor.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Security</h4>
                      <p>Consultant agrees to abide by and maintain adequate data security measures, consistent with standards and best practices within the advertising industry, and to protect Client data from unauthorized disclosure or acquisition by an unauthorized person. These measures shall include, but are not limited to:<br/>a. Passwords and Employee Access. Consultant shall secure usernames, passwords, and any other means of gaining access to the Services or to Client data. Consultant shall only provide access to Client data to employees or contractors that are performing the Services.<br/>b. Security Protocols. Both parties agree to maintain security protocols that meet industry standards in the transfer or transmission of any data, including ensuring that data may only be viewed or accessed by parties legally allowed to do so. Consultant shall maintain all data obtained or generated pursuant to the Agreement in a secure digital environment and not copy, reproduce, or transmit data obtained pursuant to the Agreement, except as necessary to fulfill the purpose of data requests.<br/>c. Two-Factor Authentication (2FA). All applications used by Consultant in servicing Client are required to enable 2FA.<br/>d. Data Breach. In the event that Consultant discovers that Client data has been accessed or obtained by an unauthorized individual, Consultant shall provide notification to Client within a reasonable amount of time of the incident, not to exceed 72 hours.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Limited Liability</h4>
                      <p>The Client agrees that any liability of Consultant relating to this agreement and the services performed shall be limited to the amount of fees actually received by Consultant during the calendar month in which the claim arose, from the Client under this agreement regarding the services in question. In no event shall either party be liable for any special, incidental, indirect, cover, consequential, exemplary or punitive damages; any damages based on injury to person or property; or any lost sales, profits or data, even if the party is told that any such damages may occur.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Warranty</h4>
                      <p>Content, branding, creative, website, digital marketing, and advertising projects are NOT subject to warranty.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Client</h4>
                      <p>A link to the Client website/application website may be placed on the Consultant web site or other collateral as part of its business portfolio.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Confidentiality</h4>
                      <p>Each party agrees that during the course of this Agreement, information that is confidential or proprietary may be disclosed to the other party, including without limitation processes, product designs, sales, cost, technology, pricing, and customer data, and other unpublished financial information, product and business plans, advertising revenues, usage rates, advertising relationships, projections and marketing data ("Confidential Information"). Each party agrees that, except as permitted by this Agreement, such party shall not make any disclosure of the Confidential Information other than to its employees who have a need to know such information in connection with this Agreement, which employees shall be notified of the confidentiality obligations with respect to the Confidential Information. The confidentiality obligations of each party and their respective employees shall survive the expiration or termination of this Agreement.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Renewal</h4>
                      <p>This Agreement shall remain in effect until terminated by either party as permitted herein. Ongoing monthly services auto-renew unless otherwise amended or terminated by Client or Consultant.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Cancellation</h4>
                      <p>Client may terminate this Agreement at any time by giving Consultant (c/o Consultant's CEO, Justin Watkins) not less than 90 days' prior written notice. Termination shall be deemed effective on the first day of the month following Consultant's receipt of such notice: (i) Consultant shall provide invoices setting forth the costs payable under this clause within 30 days of termination notice. Written notices provide a full 90-day for all work to be submitted by Consultant. (ii) Client shall pay Consultant an amount equal to the next 90 days of scheduled monthly invoices according to the agreed-upon Service Fee inclusive of outstanding fees payable under this Agreement and all hard cost expenses through the effective date of such termination within 45 days after invoice receipt.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Expiration</h4>
                      <p>Provided Client has paid Consultant the agreed-upon Service Fee as provided herein, this Agreement shall expire if 90 days past termination notice and full payment or completion of one-time only projects with no auto-renewal ongoing services rendered. In the event Client fails to pay Consultant the agreed-upon Payment Schedule as provided herein, this Agreement shall remain in full force and effect until the invoices have been paid in full. Should Client pay for billable hours and hard costs and pause, stop or choose not to utilize for any reason, those hours will be made available for up to 6 months from point of invoice issuance by Consultant. Upon 6 months non-utilization hours and hard costs will expire. Received payments for planned or completed work will be performed according to scope of work and hourly rate but not refunded. Consultant will provide the timing of when work corresponding to payment will be completed.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Additional Services</h4>
                      <p>Requests and revisions beyond what is detailed in this scope including technical support upon Client prior written approval will be billed at $195/hour. Should specifications of the project change, a new estimate will be provided for approval. If the project is canceled before completion, all accrued charges to date will be billed. In some cases, estimates may vary by +/- 10% in which instance the client will be notified of the difference along with options on how best to proceed.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Payment</h4>
                      <p>Client shall pay Consultant for the first month invoice outlined in the scope, billed upon SOW signature and due prior to project kickoff. Work will begin upon receipt. All payments are due within forty-five (45) days of billing. Payments will be made via ACH or Check to: Native Digital, 1612 Grand Suite 300, Kansas City, MO 64108. If payment is to be received via wire, Client will be responsible for any fees incurred and the cost will appear on the following month's invoice.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Interest</h4>
                      <p>Payments due and unpaid to Consultant hereunder shall bear interest at the rate of eighteen percent (18%) per annum after the sum is past due for more than sixty (60) days. Consultant reserves the right to discontinue work until accounts are settled.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Anti-poaching</h4>
                      <p>It is agreed that Client shall not knowingly hire any employee of Consultant, unless and until twelve months (12) has elapsed since their last date of employment by Agency. It is agreed that Consultant shall not knowingly hire any employee of Client unless and until twelve months (12) has elapsed since their last date of employment by Client.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Mediation</h4>
                      <p>In the event either Consultant or Client disputes the payment or performance by the other party of any obligation under this Agreement, or alleges any default hereunder by the other party, the non-defaulting party may give the other party written notice of such dispute or breach (a "Dispute Notice") setting forth in reasonable detail the dispute or default of the other party (the "Agreement Dispute"). If, within twenty (20) calendar days (or such longer period as may be agreed in writing between the parties) after receipt by a party of a Dispute Notice, the parties have not succeeded in negotiating a resolution of the Agreement Dispute, the parties agree to submit the Agreement Dispute at the earliest possible date to mediation conducted in accordance with the Commercial Mediation Rules of the American Arbitration Association ("AAA"), and to bear equally the costs of the mediation; provided, however, that each party shall bear its own costs in connection with such mediation. The parties agree to participate in good faith in the mediation and negotiations related thereto for a period of thirty (30) days or such longer period as they may mutually agree following the initial mediation session (the "Mediation Period"). In the event the parties are unable to resolve the Agreement Dispute through mediation prior to the expiration of the Mediation Period, then either party shall be entitled to pursue all of its right and remedies under this Agreement, at law or in equity, with respect to such Agreement Dispute, including without limitation pursuant to an appropriate legal action.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Applicable Law</h4>
                      <p>This Agreement shall be governed by the laws of the State of Missouri without regard to its conflict of laws provisions, and Client and Consultant agree that the sole venue and jurisdiction for disputes arising from this Agreement shall be the appropriate state or federal court located in Kansas City, Missouri, and Client and Consultant hereby submit to the jurisdiction of such courts.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Acceptance</h4>
                      <p>Changes to this Agreement will be subject to mutual written agreement of the Parties. Each Party agrees to the stated terms as of the last date written below.</p>
                    </div>
                    <div className="pdf-term-section">
                      <h4>Email Communication</h4>
                      <p>Consultant will add Client marketing team to email newsletter mailing list with approval of this scope. Emails are sent monthly with links to resources, tools and top news. The Client team may opt-out at any time by unsubscribing to the emails or initialing here: _______</p>
                    </div>
                  </div>
                </div>

                <div className="pdf-signature">
                  <p style={{ fontSize: 10, marginBottom: 20 }}>
                    NATIVE DIGITAL LLC ("Consultant") and <strong>{clientInfo.name || '[Client]'}</strong> ("Client") agree to the following terms and conditions.
                  </p>
                  <div className="pdf-sig-row">
                    <div className="pdf-sig-field">
                      <div className="pdf-sig-line"></div>
                      <div className="pdf-sig-label">Client Signature</div>
                    </div>
                    <div className="pdf-sig-field">
                      <div className="pdf-sig-line"></div>
                      <div className="pdf-sig-label">Printed Name</div>
                    </div>
                    <div className="pdf-sig-field" style={{ flex: 0.5 }}>
                      <div className="pdf-sig-line"></div>
                      <div className="pdf-sig-label">Date</div>
                    </div>
                  </div>
                  <div className="pdf-sig-row">
                    <div className="pdf-sig-field">
                      <div className="pdf-sig-line"></div>
                      <div className="pdf-sig-label">Accounts Payable Contact Name</div>
                    </div>
                    <div className="pdf-sig-field">
                      <div className="pdf-sig-line"></div>
                      <div className="pdf-sig-label">Email Address</div>
                    </div>
                  </div>
                  <div className="pdf-sig-row">
                    <div className="pdf-sig-field">
                      <div className="pdf-sig-line"></div>
                      <div className="pdf-sig-label">Native Digital, LLC</div>
                    </div>
                    <div className="pdf-sig-field">
                      <div className="pdf-sig-line"></div>
                      <div className="pdf-sig-label">Printed Name</div>
                    </div>
                    <div className="pdf-sig-field" style={{ flex: 0.5 }}>
                      <div className="pdf-sig-line"></div>
                      <div className="pdf-sig-label">Date</div>
                    </div>
                  </div>
                  <p style={{ fontSize: 10, fontStyle: 'italic', marginTop: 20 }}>
                    Once signed, your Account Manager will provide next steps and upcoming milestones.
                  </p>
                </div>
              </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
